# SABERå’¨è¯¢ç½‘ç«™ - é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆä¸€ï¼šGitéƒ¨ç½²ï¼ˆæ¨èï¼‰
- âœ… ä¾¿äºç»´æŠ¤å’Œæ›´æ–°
- âœ… æ”¯æŒç‰ˆæœ¬æ§åˆ¶
- âœ… é€‚åˆå›¢é˜Ÿåä½œ
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²

### æ–¹æ¡ˆäºŒï¼šæ‰“åŒ…ä¼ è¾“
- âœ… ä¸€æ¬¡æ€§éƒ¨ç½²
- âœ… ç½‘ç»œç¯å¢ƒå—é™æ—¶é€‚ç”¨
- âœ… ç®€å•ç›´æ¥

---

## ğŸ“¦ æ–¹æ¡ˆä¸€ï¼šGitéƒ¨ç½²ï¼ˆæ¨èï¼‰

### 1. æœ¬åœ°å‡†å¤‡

#### 1.1 åˆå§‹åŒ–Gitä»“åº“
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
git init
git add .
git commit -m "Initial commit"
```

#### 1.2 åˆ›å»ºè¿œç¨‹ä»“åº“
é€‰æ‹©ä»¥ä¸‹ä»»ä¸€å¹³å°ï¼š
- **GitHub**: https://github.com
- **GitLab**: https://gitlab.com  
- **Gitee**: https://gitee.com
- **é˜¿é‡Œäº‘Code**: https://codeup.aliyun.com

#### 1.3 æ¨é€ä»£ç 
```bash
git remote add origin <your-repository-url>
git push -u origin main
```

### 2. é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡

#### 2.1 è¿æ¥æœåŠ¡å™¨
```bash
ssh root@your-server-ip
```

#### 2.2 å®‰è£…å¿…è¦è½¯ä»¶
```bash
# æ›´æ–°ç³»ç»Ÿ
yum update -y  # CentOS
# æˆ–
apt update && apt upgrade -y  # Ubuntu

# å®‰è£…Node.js
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
yum install -y nodejs

# å®‰è£…MySQL
yum install -y mysql-server mysql
systemctl start mysqld
systemctl enable mysqld

# å®‰è£…Nginxï¼ˆå¯é€‰ï¼Œç”¨äºåå‘ä»£ç†ï¼‰
yum install -y nginx
systemctl start nginx
systemctl enable nginx

# å®‰è£…Git
yum install -y git
```

#### 2.3 é…ç½®MySQL
```bash
# å®‰å…¨é…ç½®
mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE saber_consulting CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'saber_user'@'localhost' IDENTIFIED BY 'your-password';
GRANT ALL PRIVILEGES ON saber_consulting.* TO 'saber_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. éƒ¨ç½²é¡¹ç›®

#### 3.1 å…‹éš†é¡¹ç›®
```bash
cd /opt
git clone <your-repository-url> saber-consulting
cd saber-consulting
```

#### 3.2 å®‰è£…ä¾èµ–
```bash
npm install --production
```

#### 3.3 é…ç½®ç¯å¢ƒå˜é‡
```bash
cp env.example .env
nano .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š
```env
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_USER=saber_user
DB_PASSWORD=your-password
DB_NAME=saber_consulting
DB_PORT=3306

# é‚®ç®±é…ç½®
QQ_EMAIL_PASS=your-qq-email-auth-code
HUAWEI_EMAIL_USER=your-email@your-domain.com
HUAWEI_EMAIL_PASS=your-huawei-email-auth-code

# ç®¡ç†åå°é…ç½®
ADMIN_USERNAME=Sy321098
ADMIN_PASSWORD=Sy098321

# å®‰å…¨é…ç½®
JWT_SECRET=your-production-jwt-secret-key
SESSION_SECRET=your-production-session-secret-key

# é‚®ä»¶é€šçŸ¥é…ç½®
EMAIL_NOTIFICATIONS=true
RECEIVE_EMAIL=shen.5109256@qq.com
```

#### 3.4 åˆå§‹åŒ–æ•°æ®åº“
```bash
node scripts/init-database.js
```

#### 3.5 å¯åŠ¨æœåŠ¡
```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
pm2 start start.js --name "saber-consulting"

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### 4. é…ç½®Nginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰

#### 4.1 åˆ›å»ºNginxé…ç½®
```bash
nano /etc/nginx/conf.d/saber-consulting.conf
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        proxy_pass http://localhost:3000;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 4.2 é‡å¯Nginx
```bash
nginx -t
systemctl restart nginx
```

### 5. é…ç½®é˜²ç«å¢™
```bash
# å¼€æ”¾ç«¯å£
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --reload
```

---

## ğŸ“¦ æ–¹æ¡ˆäºŒï¼šæ‰“åŒ…ä¼ è¾“

### 1. æœ¬åœ°æ‰“åŒ…

#### 1.1 è¿è¡Œéƒ¨ç½²è„šæœ¬
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
chmod +x deploy/deploy-to-aliyun.sh
./deploy/deploy-to-aliyun.sh
```

#### 1.2 ä¸Šä¼ åˆ°æœåŠ¡å™¨
```bash
# ä½¿ç”¨scpä¸Šä¼ 
scp saber-deploy-*.tar.gz root@your-server-ip:/opt/

# æˆ–ä½¿ç”¨å…¶ä»–å·¥å…·ä¸Šä¼ 
```

### 2. æœåŠ¡å™¨éƒ¨ç½²

#### 2.1 è§£å‹æ–‡ä»¶
```bash
cd /opt
tar -xzf saber-deploy-*.tar.gz
cd saber-deploy-*
```

#### 2.2 æŒ‰ç…§DEPLOY_README.mdä¸­çš„è¯´æ˜è¿›è¡Œéƒ¨ç½²

---

## ğŸ”§ ç»´æŠ¤å’Œæ›´æ–°

### Gitéƒ¨ç½²æ–¹å¼æ›´æ–°
```bash
# æœ¬åœ°æ›´æ–°ä»£ç 
git add .
git commit -m "Update description"
git push origin main

# æœåŠ¡å™¨æ›´æ–°
cd /opt/saber-consulting
git pull origin main
npm install --production
pm2 restart saber-consulting
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹PM2çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs saber-consulting

# é‡å¯æœåŠ¡
pm2 restart saber-consulting
```

### æ•°æ®åº“å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p saber_consulting > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u root -p saber_consulting < backup_20231201.sql
```

---

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **ç½‘ç«™é¦–é¡µ**: http://your-server-ip:3000
- **ç®¡ç†åå°**: http://your-server-ip:3000/admin
- **é‚®ä»¶æµ‹è¯•**: http://your-server-ip:3000/test

å¦‚æœé…ç½®äº†Nginxåå‘ä»£ç†ï¼š
- **ç½‘ç«™é¦–é¡µ**: http://your-domain.com
- **ç®¡ç†åå°**: http://your-domain.com/admin
- **é‚®ä»¶æµ‹è¯•**: http://your-domain.com/test

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨é…ç½®**
   - ä¿®æ”¹é»˜è®¤çš„ç®¡ç†å‘˜å¯†ç 
   - é…ç½®å¼ºå¯†ç çš„JWT_SECRETå’ŒSESSION_SECRET
   - å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…

2. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨Nginxåå‘ä»£ç†
   - é…ç½®é™æ€æ–‡ä»¶ç¼“å­˜
   - å¯ç”¨Gzipå‹ç¼©

3. **ç›‘æ§å’Œæ—¥å¿—**
   - ä½¿ç”¨PM2ç›‘æ§åº”ç”¨çŠ¶æ€
   - é…ç½®æ—¥å¿—è½®è½¬
   - è®¾ç½®å‘Šè­¦æœºåˆ¶

4. **å¤‡ä»½ç­–ç•¥**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½é…ç½®æ–‡ä»¶
   - æµ‹è¯•æ¢å¤æµç¨‹

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ
A: ä¿®æ”¹.envæ–‡ä»¶ä¸­çš„PORTé…ç½®ï¼Œæˆ–ä½¿ç”¨`netstat -tulpn | grep :3000`æŸ¥çœ‹å ç”¨è¿›ç¨‹

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€ã€ç”¨æˆ·åå¯†ç ã€æ•°æ®åº“åç§°æ˜¯å¦æ­£ç¡®

### Q: é‚®ä»¶å‘é€å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥é‚®ç®±æˆæƒç é…ç½®ã€é˜²ç«å¢™è®¾ç½®ã€SMTPç«¯å£æ˜¯å¦å¼€æ”¾

### Q: æœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ
A: æŸ¥çœ‹PM2æ—¥å¿—ï¼š`pm2 logs saber-consulting`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨æ—¥å¿—
2. åº”ç”¨æ—¥å¿—
3. ç½‘ç»œè¿æ¥
4. é…ç½®æ–‡ä»¶

å»ºè®®ä½¿ç”¨Gitéƒ¨ç½²æ–¹å¼ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œç‰ˆæœ¬å›æ»šã€‚
